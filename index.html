<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assigment 3 Jeremia Jordan Sihombing</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 

</head>
<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>

<body style="background-color: black;">
  <header>
    <nav class="container navbar bg-light mt-4 rounded-1 shadow">
        <div class="container-fluid">
            <a href="#" class="navbar-brand mx-auto text-center fw-bold navy rounded py-2 px-5">
                <h1 class="fw-bolder navy">Covid-19 Tracker</h1>
                <form class="d-flex" role="search">
                  <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search" id="country">
                  <input class="form-control me-2" type="date"   placeholder="Search" aria-label="Search" id="date">
                  <button class="btn btn-dark" type="submit" id="searchData">Search</button>
                </form>
                 </a> 
        </div>
    </nav>
  
    <section>
      <div class="container navbar bg-light mt-4 rounded-1 shadow">
        <div class="container">
       
            <div class="row justify-content-around" >
              <div class="col-5 box rounded-4 mb-3 border border-dark  text-center">
                  <h4>Active Cases</h4>
                  <h4 id="active_cases"></h4>
              </div>
              <div class="col-5 box rounded-4 mb-3 border border-dark text-center">
                <h4>New Cases</h4>
                <h4 id="new_cases"></h4>
            </div>
            <div class="col-5 box rounded-4 mb-3 border border-dark text-center">
              <h4>Recovered Cases</h4>
              <h4 id="recovered_cases"></h4>
          </div>
          <div class="col-5 box rounded-4 mb-3 border border-dark text-center">
            <h4>Total Cases</h4>
            <h4 id="total_cases"></h4>
        </div>
        <div class="col-5 box rounded-4 mb-3 border border-dark text-center">
          <h4>Total death</h4>
          <h4 id="total_death"></h4>
      </div>
      <div class="col-5 box rounded-4 mb-3 border border-dark text-center">
        <h4>Total Tests</h4>
        <h4 id="total_tests"></h4>
    </div>
    
          </div>
        </div>
      </div>
    </section>
</header>
<script>
  var activeCasesDOM;
  var activeCasesDOM;
  var newCasesDOM;
  var recoveredCasesDOM;
  var totalCasesDOM;
  var totalDeathDOM;
  var totalTestsDOM;

  var COUNTRIES = [];

  const APIKEY = ""

  const getDate=()=>{
    const today = new Date();
    const yyyy = today.getFullYear();
    let mm = today.getMonth() + 1;
    let dd = today.getDate();

    if (dd < 10) dd = '0' + dd;
    if (mm < 10) mm = '0' + mm;

    return yyyy + '-' + mm + '-' + dd
  }
  
  const getAllStatistic=()=>{
    const options = {
      method: 'GET',
      headers: {
        'X-RapidAPI-Key': "",
        'X-RapidAPI-Host': 'covid-193.p.rapidapi.com'
      }
    };

    fetch('https://covid-193.p.rapidapi.com/statistics', options)
      .then(response => response.json())
      .then(response => console.log(response))
      .catch(err => console.error(err));
  }

  const getAllCountries=()=>{
    const options = {
      method: 'GET',
      headers: {
        'X-RapidAPI-Key': APIKEY,
        'X-RapidAPI-Host': 'covid-193.p.rapidapi.com'
      }
    };

    fetch('https://covid-193.p.rapidapi.com/countries', options)
      .then(response => response.json())
      .then(response => COUNTRIES = response.response)
      .catch(err => console.error(err));
  }

  const getCountryHistory=(country='Indonesia', day=getDate())=>{
    const options = {
      method: 'GET',
      headers: {
        'X-RapidAPI-Key': 'e737458cf6mshce79b005d30db83p1e6239jsnde3f260800c1',
        'X-RapidAPI-Host': 'covid-193.p.rapidapi.com'
      }
    };
    const data = {
      country: country,
      day: day
    };
    const searchParams = new URLSearchParams(data);

    fetch('https://covid-193.p.rapidapi.com/history?'+ searchParams, options)
      .then(response => response.json())
      .then(response => loadDataToDOM(response['response'][0]))
      .catch(err => console.error(err));
  }

  function formatNumber(number){
    return new Intl.NumberFormat('id-ID', { maximumSignificantDigits: 3 }).format(number)
  }

  const loadDataToDOM = (data)=>{
    activeCasesDOM.innerText = formatNumber(data['cases']['active'])
    if(data['cases']['new']){
      newCasesDOM.innerText = formatNumber(data['cases']['new'])
    }else{
      newCasesDOM.innerText = "0" 
    }
    recoveredCasesDOM.innerText =   formatNumber(data['cases']['recovered'])
    totalCasesDOM.innerText =   formatNumber(data['cases']['total'])
    totalDeathDOM.innerText = formatNumber(data['deaths']['total'])
    totalTestsDOM.innerText = formatNumber(data['tests']['total'])
  }

  window.addEventListener('DOMContentLoaded', (event) => {
      activeCasesDOM = document.getElementById('active_cases')
      newCasesDOM = document.getElementById('new_cases')
      recoveredCasesDOM = document.getElementById('recovered_cases')
      totalCasesDOM = document.getElementById('total_cases')
      totalDeathDOM = document.getElementById('total_death')
      totalTestsDOM = document.getElementById('total_tests')

      getCountryHistory()
      getAllCountries()

      
      document.getElementById("searchData").addEventListener("click", function(e){
        e.preventDefault()
        const country = document.getElementById('country').value
        const date = document.getElementById('date').value

        if(!country){
          alert('Negara tidak boleh kosong !')
          return;
        }

        if(COUNTRIES.includes(country)){
          if(date){
            getCountryHistory(country, date)
          }else{
            getCountryHistory(country)
          }
        }else{
          alert('Negara tidak ditemukan !')
          return
        }
                
      });

  });



</script>
</body>
</html>
